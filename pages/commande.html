<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Finaliser votre commande - myhygia">
    <title>Commande - myhygia</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/pages.css">
    <link rel="stylesheet" href="../css/responsive.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="../assets/images/logo/logo.jpg">
</head>
<body>
    <!-- Header -->
    <header class="header" id="header">
        <div class="header__container">
            <a href="../index.html" class="header__logo">
                <img src="../assets/images/logo/logo.jpg" alt="myhygia Logo">
                <span class="header__logo-text">myhygia</span>
            </a>
            
            <button class="mobile-menu-toggle" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            
            <nav class="nav">
                <ul class="nav__list">
                    <li><a href="../index.html" class="nav__link">Accueil</a></li>
                    <li><a href="boutique.html" class="nav__link">Boutique</a></li>
                    <li><a href="../index.html#about" class="nav__link">À propos</a></li>
                    <li><a href="../index.html#contact" class="nav__link">Contact</a></li>
                </ul>
                <a href="panier.html" class="cart-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"/>
                        <circle cx="20" cy="21" r="1"/>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
                    </svg>
                    <span>Panier</span>
                    <span class="cart-badge" style="display: none;">0</span>
                </a>
            </nav>
        </div>
    </header>

    <main class="checkout-page">
        <div class="checkout__container">
            <div class="checkout__header">
                <h1 class="checkout__title">Finaliser la Commande</h1>
            </div>

            <div class="checkout__content">
                <!-- Order Form -->
                <div class="checkout__form-section">
                    <h2>Informations de livraison</h2>
                    <form id="checkout-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="firstName" class="form-label">
                                    Prénom <span class="required">*</span>
                                </label>
                                <input type="text" id="firstName" name="firstName" class="form-input" required placeholder="Votre prénom">
                                <span class="form-error" id="firstName-error"></span>
                            </div>
                            <div class="form-group">
                                <label for="lastName" class="form-label">
                                    Nom <span class="required">*</span>
                                </label>
                                <input type="text" id="lastName" name="lastName" class="form-input" required placeholder="Votre nom">
                                <span class="form-error" id="lastName-error"></span>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="email" class="form-label">
                                    Email <span class="required">*</span>
                                </label>
                                <input type="email" id="email" name="email" class="form-input" required placeholder="votre@email.com">
                                <span class="form-error" id="email-error"></span>
                            </div>
                            <div class="form-group">
                                <label for="phone" class="form-label">
                                    Téléphone <span class="required">*</span>
                                </label>
                                <input type="tel" id="phone" name="phone" class="form-input" required placeholder="06 00 00 00 00">
                                <span class="form-error" id="phone-error"></span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="address" class="form-label">
                                Adresse complète <span class="required">*</span>
                            </label>
                            <input type="text" id="address" name="address" class="form-input" required placeholder="Numéro et nom de rue">
                            <span class="form-error" id="address-error"></span>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="city" class="form-label">
                                    Ville <span class="required">*</span>
                                </label>
                                <input type="text" id="city" name="city" class="form-input" required placeholder="Votre ville">
                                <span class="form-error" id="city-error"></span>
                            </div>
                            <div class="form-group">
                                <label for="postalCode" class="form-label">
                                    Code postal
                                </label>
                                <input type="text" id="postalCode" name="postalCode" class="form-input" placeholder="Code postal">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="comments" class="form-label">
                                Commentaires (optionnel)
                            </label>
                            <textarea id="comments" name="comments" class="form-textarea" placeholder="Instructions spéciales pour la livraison, remarques..."></textarea>
                        </div>
                    </form>
                </div>

                <!-- Order Summary Sidebar -->
                <div class="checkout__sidebar">
                    <div class="checkout__order-summary">
                        <h2>Récapitulatif de commande</h2>
                        <div class="checkout__items" id="checkout-items">
                            <!-- Items will be loaded by JavaScript -->
                        </div>
                        <div class="checkout__totals" id="checkout-totals">
                            <!-- Totals will be loaded by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="checkout__submit">
                        <button type="submit" form="checkout-form" class="btn btn-primary btn-lg btn-block checkout__submit-btn">
                            Passer la commande
                        </button>
                        <div class="checkout__secure">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                            </svg>
                            <span>Paiement sécurisé à la livraison</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer__grid">
            <div class="footer__section footer__about">
                <h3>myhygia</h3>
                <p>
                    Votre spécialiste en calots et bonnets médicaux de qualité. 
                    Nous accompagnons les professionnels de santé au quotidien.
                </p>
            </div>
            
            <div class="footer__section">
                <h3>Liens Rapides</h3>
                <div class="footer__links">
                    <a href="../index.html" class="footer__link">Accueil</a>
                    <a href="boutique.html" class="footer__link">Boutique</a>
                    <a href="../index.html#about" class="footer__link">À propos</a>
                    <a href="panier.html" class="footer__link">Panier</a>
                </div>
            </div>
            
            <div class="footer__section">
                <h3>Contact</h3>
                <div class="footer__contact-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                    </svg>
                    <span>+216 96 025 340</span>
                </div>
                <div class="footer__contact-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                        <polyline points="22,6 12,13 2,6"></polyline>
                    </svg>
                    <span>contact@myhygia.ma</span>
                </div>
            </div>
        </div>
        
        <div class="footer__bottom">
            <p>&copy; 2026 myhygia. Tous droits réservés.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="../js/products.js"></script>
    <script src="../js/cart.js"></script>
    <script src="../js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const cart = Cart.getCart();
            
            // Redirect if cart is empty
            if (cart.length === 0) {
                window.location.href = 'panier.html';
                return;
            }
            
            // Render order summary
            renderOrderSummary();
            
            // Form submission
            const form = document.getElementById('checkout-form');
            form.addEventListener('submit', handleSubmit);
        });
        
        function renderOrderSummary() {
            const cart = Cart.getCart();
            const itemsContainer = document.getElementById('checkout-items');
            const totalsContainer = document.getElementById('checkout-totals');
            
            // Render items
            itemsContainer.innerHTML = cart.map(item => `
                <div class="checkout-item">
                    <img src="../${item.image}" alt="${item.name}" class="checkout-item__image">
                    <div class="checkout-item__info">
                        <div class="checkout-item__name">${item.name}</div>
                        <div class="checkout-item__meta">Qté: ${item.quantity}</div>
                    </div>
                    <div class="checkout-item__price">${item.price * item.quantity} DT</div>
                </div>
            `).join('');
            
            // Render totals
            const subtotal = Cart.getSubtotal();
            const shipping = Cart.getShipping();
            const total = Cart.getTotal();
            
            totalsContainer.innerHTML = `
                <div class="checkout__totals-row">
                    <span>Sous-total</span>
                    <span>${subtotal} DT</span>
                </div>
                <div class="checkout__totals-row">
                    <span>Livraison</span>
                    <span>${shipping === 0 ? 'Gratuite' : shipping + ' DT'}</span>
                </div>
                <div class="checkout__totals-row total">
                    <span>Total</span>
                    <span>${total} DT</span>
                </div>
            `;
        }
        
        function handleSubmit(e) {
            e.preventDefault();
            
            // Clear previous errors
            document.querySelectorAll('.form-error').forEach(el => el.textContent = '');
            document.querySelectorAll('.form-input.error').forEach(el => el.classList.remove('error'));
            
            // Get form data
            const formData = {
                firstName: document.getElementById('firstName').value.trim(),
                lastName: document.getElementById('lastName').value.trim(),
                email: document.getElementById('email').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                address: document.getElementById('address').value.trim(),
                city: document.getElementById('city').value.trim(),
                postalCode: document.getElementById('postalCode').value.trim(),
                comments: document.getElementById('comments').value.trim()
            };
            
            // Validate
            let isValid = true;
            
            if (!formData.firstName) {
                showError('firstName', 'Le prénom est requis');
                isValid = false;
            }
            
            if (!formData.lastName) {
                showError('lastName', 'Le nom est requis');
                isValid = false;
            }
            
            if (!formData.email || !Utils.validateEmail(formData.email)) {
                showError('email', 'Email invalide');
                isValid = false;
            }
            
            if (!formData.phone) {
                showError('phone', 'Le téléphone est requis');
                isValid = false;
            }
            
            if (!formData.address) {
                showError('address', 'L\'adresse est requise');
                isValid = false;
            }
            
            if (!formData.city) {
                showError('city', 'La ville est requise');
                isValid = false;
            }
            
            if (!isValid) return;
            
            // Prepare order data
            const orderData = {
                customer: formData,
                items: Cart.getCart(),
                subtotal: Cart.getSubtotal(),
                shipping: Cart.getShipping(),
                total: Cart.getTotal(),
                date: new Date().toISOString(),
                orderNumber: 'MS-' + Date.now()
            };
            
            // Store order for confirmation page
            localStorage.setItem('lastOrder', JSON.stringify(orderData));
            
            // Clear cart
            Cart.clearCart();
            
            // Redirect to confirmation
            window.location.href = 'confirmation.html';
        }
        
        function showError(field, message) {
            document.getElementById(field).classList.add('error');
            document.getElementById(field + '-error').textContent = message;
        }
    </script>
</body>
</html>
